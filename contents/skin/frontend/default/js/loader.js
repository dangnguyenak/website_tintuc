(function(d,K){function L(){}function C(h,c){if(h){"object"==typeof h&&(h=[].slice.call(h));for(var b=0,f=h.length;b<f;b++)c.call(h,h[b],b)}}function ca(h,b){var c=Object.prototype.toString.call(b).slice(8,-1);return b!==K&&null!==b&&c===h}function E(b){return ca("Function",b)}function p(b){return ca("Array",b)}function r(b){(b=b||L,b._done)||(b(),b._done=1)}function z(b){var c={},f,g;if("object"==typeof b)for(f in b)!b[f]||(c={name:f,url:b[f]});else c=b.split("/"),c=c[c.length-1],f=c.indexOf("?"),
c={name:-1!==f?c.substring(0,f):c,url:b};return(g=B[c.name],g&&g.url===c.url)?g:(B[c.name]=c,c)}function f(b){b=b||B;for(var c in b)if(b.hasOwnProperty(c)&&b[c].state!==R)return!1;return!0}function k(b){b.state=M;C(b.onpreload,function(b){b.call()})}function b(b){b.state===K&&(b.state=Ba,b.onpreload=[],q({url:b.url,type:"cache"},function(){k(b)}))}function c(){var c=arguments,f=c[c.length-1],g=[].slice.call(c,1),r=g[0];return(E(f)||(f=null),p(c[0]))?(c[0].push(f),s.load.apply(null,c[0]),s):(r?(C(g,
function(c){E(c)||!c||b(z(c))}),Z(z(c[0]),E(r)?r:function(){s.load.apply(null,g)})):Z(z(c[0])),s)}function t(){var b=arguments,c=b[b.length-1],g={};return(E(c)||(c=null),p(b[0]))?(b[0].push(c),s.load.apply(null,b[0]),s):(C(b,function(b){b!==c&&(b=z(b),g[b.name]=b)}),C(b,function(b){b!==c&&(b=z(b),Z(b,function(){f(g)&&r(c)}))}),s)}function Z(b,c){(c=c||L,b.state===R)?c():b.state===la?s.ready(b.name,c):b.state===Ba?b.onpreload.push(function(){Z(b,c)}):(b.state=la,q(b,function(){b.state=R;c();C(da[b.name],
function(b){r(b)});T&&f()&&C(da.ALL,function(b){r(b)})}))}function ea(b){b=(b||"").split("?")[0].split(".");return b[b.length-1].toLowerCase()}function q(b,c){function f(b){k.onload=k.onreadystatechange=k.onerror=null;c()}function r(u){u=u||d.event;("load"===u.type||/loaded|complete/.test(k.readyState)&&(!g.documentMode||9>g.documentMode))&&(d.clearTimeout(b.errorTimeout),d.clearTimeout(b.cssTimeout),k.onload=k.onreadystatechange=k.onerror=null,c())}function p(){if(b.state!==R&&20>=b.cssRetries){for(var c=
0,m=g.styleSheets.length;c<m;c++)if(g.styleSheets[c].href===k.href){r({type:"load"});return}b.cssRetries++;b.cssTimeout=d.setTimeout(p,250)}}var k,q;c=c||L;"css"===ea(b.url)?(k=g.createElement("link"),k.type="text/"+(b.type||"css"),k.rel="stylesheet",k.href=b.url,b.cssRetries=0,b.cssTimeout=d.setTimeout(p,500)):(k=g.createElement("script"),k.type="text/"+(b.type||"javascript"),k.src=b.url);k.onload=k.onreadystatechange=r;k.onerror=f;k.async=!1;k.defer=!1;b.errorTimeout=d.setTimeout(function(){f({type:"timeout"})},
7E3);q=g.head||g.getElementsByTagName("head")[0];q.insertBefore(k,q.lastChild)}function v(){for(var b,c=g.getElementsByTagName("script"),f=0,k=c.length;f<k;f++)if(b=c[f].getAttribute("data-headjs-load"),b){s.load(b);break}}function y(){g.body?T||(T=!0,v(),C(G,function(b){r(b)})):(d.clearTimeout(s.readyTimeout),s.readyTimeout=d.setTimeout(y,50))}function H(){g.addEventListener?(g.removeEventListener("DOMContentLoaded",H,!1),y()):"complete"===g.readyState&&(g.detachEvent("onreadystatechange",H),y())}
var g=d.document,G=[],da={},B={},N="async"in g.createElement("script")||"MozAppearance"in g.documentElement.style||d.opera,T,U=d.head_conf&&d.head_conf.head||"sbz_head",s=d[U]=d[U]||function(){s.ready.apply(null,arguments)},Ba=1,M=2,la=3,R=4,P;if("complete"===g.readyState)y();else if(g.addEventListener)g.addEventListener("DOMContentLoaded",H,!1),d.addEventListener("load",y,!1);else{g.attachEvent("onreadystatechange",H);d.attachEvent("onload",y);P=!1;try{P=!d.frameElement&&g.documentElement}catch(Ca){}P&&
P.doScroll&&function Q(){if(!T){try{P.doScroll("left")}catch(b){d.clearTimeout(s.readyTimeout);s.readyTimeout=d.setTimeout(Q,50);return}y()}}()}s.load=s.js=N?t:c;s.test=function(b,c,f,g){b="object"==typeof b?b:{test:b,success:c?p(c)?c:[c]:!1,failure:f?p(f)?f:[f]:!1,callback:g||L};c=!!b.test;return c&&b.success?(b.success.push(b.callback),s.load.apply(null,b.success)):c||!b.failure?g():(b.failure.push(b.callback),s.load.apply(null,b.failure)),s};s.ready=function(b,c){var k,q,d;return b===g?(T?r(c):
G.push(c),s):(E(b)&&(c=b,b="ALL"),p(b))?(k={},C(b,function(b){k[b]=B[b];s.ready(b,function(){f(k)&&r(c)})}),s):"string"==typeof b&&E(c)?(q=B[b],q&&q.state===R||"ALL"===b&&f()&&T)?(r(c),s):(d=da[b],d?d.push(c):d=da[b]=[c],s):s};s.ready(g,function(){f()&&C(da.ALL,function(b){r(b)});s.feature&&s.feature("domloaded",!0)})})(window);
(function(d){function K(p,r){function z(b){if(z[b]!==g)return z[b];var m;if("bug-string-char-index"==b)m="a"!="a"[0];else if("json"==b)m=z("json-stringify")&&z("json-parse");else{var I;if("json-stringify"==b){m=r.stringify;var h="function"==typeof m&&G;if(h){(I=function(){return 1}).toJSON=I;try{h="0"===m(0)&&"0"===m(new f)&&'""'==m(new k)&&m(v)===g&&m(g)===g&&m()===g&&"1"===m(I)&&"[1]"==m([I])&&"[null]"==m([g])&&"null"==m(null)&&"[null,null,null]"==m([g,v,null])&&'{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}'==
m({a:[I,!0,!1,null,"\x00\b\n\f\r\t"]})&&"1"===m(null,I)&&"[\n 1,\n 2\n]"==m([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==m(new c(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==m(new c(864E13))&&'"-000001-01-01T00:00:00.000Z"'==m(new c(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==m(new c(-1))}catch(p){h=!1}}m=h}if("json-parse"==b){m=r.parse;if("function"==typeof m)try{if(0===m("0")&&!m(!1)){I=m('{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}');var d=5==I.a.length&&1===I.a[0];if(d){try{d=!m('"\t"')}catch(J){}if(d)try{d=
1!==m("01")}catch(Na){}if(d)try{d=1!==m("1.")}catch(q){}}}}catch(Pa){d=!1}m=d}}return z[b]=!!m}p||(p=d.Object());r||(r=d.Object());var f=p.Number||d.Number,k=p.String||d.String,b=p.Object||d.Object,c=p.Date||d.Date,t=p.SyntaxError||d.SyntaxError,C=p.TypeError||d.TypeError,E=p.Math||d.Math,q=p.JSON||d.JSON;"object"==typeof q&&q&&(r.stringify=q.stringify,r.parse=q.parse);var b=b.prototype,v=b.toString,y,H,g,G=new c(-0xc782b5b800cec);try{G=-109252==G.getUTCFullYear()&&0===G.getUTCMonth()&&1===G.getUTCDate()&&
10==G.getUTCHours()&&37==G.getUTCMinutes()&&6==G.getUTCSeconds()&&708==G.getUTCMilliseconds()}catch(L){}if(!z("json")){var B=z("bug-string-char-index");if(!G)var N=E.floor,T=[0,31,59,90,120,151,181,212,243,273,304,334],U=function(b,c){return T[c]+365*(b-1970)+N((b-1969+(c=+(1<c)))/4)-N((b-1901+c)/100)+N((b-1601+c)/400)};(y=b.hasOwnProperty)||(y=function(b){var c={},f;(c.__proto__=null,c.__proto__={toString:1},c).toString!=v?y=function(b){var c=this.__proto__;b=b in(this.__proto__=null,this);this.__proto__=
c;return b}:(f=c.constructor,y=function(b){var c=(this.constructor||f).prototype;return b in this&&!(b in c&&this[b]===c[b])});c=null;return y.call(this,b)});var s={"boolean":1,number:1,string:1,undefined:1};H=function(b,c){var f=0,h,k,g;(h=function(){this.valueOf=0}).prototype.valueOf=0;k=new h;for(g in k)y.call(k,g)&&f++;h=k=null;f?H=2==f?function(b,c){var f={},u="[object Function]"==v.call(b),m;for(m in b)u&&"prototype"==m||y.call(f,m)||!(f[m]=1)||!y.call(b,m)||c(m)}:function(b,c){var f="[object Function]"==
v.call(b),u,m;for(u in b)f&&"prototype"==u||!y.call(b,u)||(m="constructor"===u)||c(u);(m||y.call(b,u="constructor"))&&c(u)}:(k="valueOf toString toLocaleString propertyIsEnumerable isPrototypeOf hasOwnProperty constructor".split(" "),H=function(b,c){var u="[object Function]"==v.call(b),f,m;if(m=!u)if(m="function"!=typeof b.constructor)m=typeof b.hasOwnProperty,m="object"==m?!!b.hasOwnProperty:!s[m];m=m?b.hasOwnProperty:y;for(f in b)u&&"prototype"==f||!m.call(b,f)||c(f);for(u=k.length;f=k[--u];m.call(b,
f)&&c(f));});return H(b,c)};if(!z("json-stringify")){var ca={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},M=function(b,c){return("000000"+(c||0)).slice(-b)},la=function(b){for(var c='"',f=0,k=b.length,h=!B||10<k,g=h&&(B?b.split(""):b);f<k;f++){var J=b.charCodeAt(f);switch(J){case 8:case 9:case 10:case 12:case 13:case 34:case 92:c+=ca[J];break;default:if(32>J){c+="\\u00"+M(2,J.toString(16));break}c+=h?g[f]:b.charAt(f)}}return c+'"'},R=function(b,c,f,k,h,r,J){var d,p,q,s,t,z,w,E,B;
try{d=c[b]}catch(G){}if("object"==typeof d&&d)if(p=v.call(d),"[object Date]"!=p||y.call(d,"toJSON"))"function"==typeof d.toJSON&&("[object Number]"!=p&&"[object String]"!=p&&"[object Array]"!=p||y.call(d,"toJSON"))&&(d=d.toJSON(b));else if(d>-1/0&&d<1/0){if(U){s=N(d/864E5);for(p=N(s/365.2425)+1970-1;U(p+1,0)<=s;p++);for(q=N((s-U(p,0))/30.42);U(p,q+1)<=s;q++);s=1+s-U(p,q);t=(d%864E5+864E5)%864E5;z=N(t/36E5)%24;w=N(t/6E4)%60;E=N(t/1E3)%60;t%=1E3}else p=d.getUTCFullYear(),q=d.getUTCMonth(),s=d.getUTCDate(),
z=d.getUTCHours(),w=d.getUTCMinutes(),E=d.getUTCSeconds(),t=d.getUTCMilliseconds();d=(0>=p||1E4<=p?(0>p?"-":"+")+M(6,0>p?-p:p):M(4,p))+"-"+M(2,q+1)+"-"+M(2,s)+"T"+M(2,z)+":"+M(2,w)+":"+M(2,E)+"."+M(3,t)+"Z"}else d=null;f&&(d=f.call(c,b,d));if(null===d)return"null";p=v.call(d);if("[object Boolean]"==p)return""+d;if("[object Number]"==p)return d>-1/0&&d<1/0?""+d:"null";if("[object String]"==p)return la(""+d);if("object"==typeof d){for(b=J.length;b--;)if(J[b]===d)throw C();J.push(d);B=[];c=r;r+=h;if("[object Array]"==
p){q=0;for(b=d.length;q<b;q++)p=R(q,d,f,k,h,r,J),B.push(p===g?"null":p);b=B.length?h?"[\n"+r+B.join(",\n"+r)+"\n"+c+"]":"["+B.join(",")+"]":"[]"}else H(k||d,function(b){var c=R(b,d,f,k,h,r,J);c!==g&&B.push(la(b)+":"+(h?" ":"")+c)}),b=B.length?h?"{\n"+r+B.join(",\n"+r)+"\n"+c+"}":"{"+B.join(",")+"}":"{}";J.pop();return b}};r.stringify=function(b,c,f){var d,k,h,p;if("function"==typeof c||"object"==typeof c&&c)if("[object Function]"==(p=v.call(c)))k=c;else if("[object Array]"==p){h={};for(var g=0,r=
c.length,q;g<r;q=c[g++],(p=v.call(q),"[object String]"==p||"[object Number]"==p)&&(h[q]=1));}if(f)if("[object Number]"==(p=v.call(f))){if(0<(f-=f%1))for(d="",10<f&&(f=10);d.length<f;d+=" ");}else"[object String]"==p&&(d=10>=f.length?f:f.slice(0,10));return R("",(q={},q[""]=b,q),k,h,d,"",[])}}if(!z("json-parse")){var P=k.fromCharCode,Ca={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},h,Q,w=function(){h=Q=null;throw t();},S=function(){for(var b=Q,c=b.length,f,d,k,p,g;h<c;)switch(g=
b.charCodeAt(h),g){case 9:case 10:case 13:case 32:h++;break;case 123:case 125:case 91:case 93:case 58:case 44:return f=B?b.charAt(h):b[h],h++,f;case 34:f="@";for(h++;h<c;)if(g=b.charCodeAt(h),32>g)w();else if(92==g)switch(g=b.charCodeAt(++h),g){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:f+=Ca[g];h++;break;case 117:d=++h;for(k=h+4;h<k;h++)g=b.charCodeAt(h),48<=g&&57>=g||97<=g&&102>=g||65<=g&&70>=g||w();f+=P("0x"+b.slice(d,h));break;default:w()}else{if(34==g)break;g=b.charCodeAt(h);
for(d=h;32<=g&&92!=g&&34!=g;)g=b.charCodeAt(++h);f+=b.slice(d,h)}if(34==b.charCodeAt(h))return h++,f;w();default:d=h;45==g&&(p=!0,g=b.charCodeAt(++h));if(48<=g&&57>=g){for(48==g&&(g=b.charCodeAt(h+1),48<=g&&57>=g)&&w();h<c&&(g=b.charCodeAt(h),48<=g&&57>=g);h++);if(46==b.charCodeAt(h)){for(k=++h;k<c&&(g=b.charCodeAt(k),48<=g&&57>=g);k++);k==h&&w();h=k}g=b.charCodeAt(h);if(101==g||69==g){g=b.charCodeAt(++h);43!=g&&45!=g||h++;for(k=h;k<c&&(g=b.charCodeAt(k),48<=g&&57>=g);k++);k==h&&w();h=k}return+b.slice(d,
h)}p&&w();if("true"==b.slice(h,h+4))return h+=4,!0;if("false"==b.slice(h,h+5))return h+=5,!1;if("null"==b.slice(h,h+4))return h+=4,null;w()}return"$"},sa=function(b){var c,f;"$"==b&&w();if("string"==typeof b){if("@"==(B?b.charAt(0):b[0]))return b.slice(1);if("["==b){for(c=[];;f||(f=!0)){b=S();if("]"==b)break;f&&(","==b?(b=S(),"]"==b&&w()):w());","==b&&w();c.push(sa(b))}return c}if("{"==b){for(c={};;f||(f=!0)){b=S();if("}"==b)break;f&&(","==b?(b=S(),"}"==b&&w()):w());","!=b&&"string"==typeof b&&"@"==
(B?b.charAt(0):b[0])&&":"==S()||w();c[b.slice(1)]=sa(S())}return c}w()}return b},ta=function(b,c,f){f=oa(b,c,f);f===g?delete b[c]:b[c]=f},oa=function(b,c,f){var g=b[c],d;if("object"==typeof g&&g)if("[object Array]"==v.call(g))for(d=g.length;d--;)ta(g,d,f);else H(g,function(b){ta(g,b,f)});return f.call(b,c,g)};r.parse=function(b,c){var f,g;h=0;Q=""+b;f=sa(S());"$"!=S()&&w();h=Q=null;return c&&"[object Function]"==v.call(c)?oa((g={},g[""]=f,g),"",c):f}}}r.runInContext=K;return r}var L="function"===
typeof define&&define.amd,C="object"==typeof global&&global;!C||C.global!==C&&C.window!==C||(d=C);if("object"!=typeof exports||!exports||exports.nodeType||L){var ca=d.JSON,E=K(d,d.JSON3={noConflict:function(){d.JSON=ca;return E}});d.JSON={parse:E.parse,stringify:E.stringify}}else K(d,exports);L&&define(function(){return E})})(this);"undefined"!=typeof subiz_account_id&&0<subiz_account_id&&!window._sbzq&&(window._sbzq=[["_setAccount",subiz_account_id]]);
(function(d){var K=JSON3.noConflict(),L=sbz_head,C={htmlRegex:/<(\/)?(\w+)(?:(?:\s+\w+(?:\s*=\s*(?:".*?"|'.*?'|[^'">\s]+))?)+\s*|\s*)\/?>/g,prefixRegex:/^(https?:\/\/)?(www\.)?/,link:function(a,b){function c(a){return a=a.replace(f,function(a,b,c,cb,A,e){var f="",V="",Qa=[];if(")"===a.charAt(a.length-1)){var n=a.match(/\(/g),r=a.match(/\)/g);(n&&n.length||0)<(r&&r.length||0)&&(a=a.substr(0,a.length-1),V=")")}n=a;if(b&&!l||A&&!h||e&&!p)return f+a+V;b?(f=c,n="https://twitter.com/"+cb,a="@"+cb):A?(n=
"mailto:"+A,a=A):/^[A-Za-z]{3,9}:/i.test(n)||(n="http://"+n);d&&(a=a.replace(C.prefixRegex,""));"/"===a.charAt(a.length-1)&&(a=a.slice(0,-1));Qa.push('href="'+n+'"');g&&Qa.push('target="_blank"');k&&a.length>k&&(a=a.substring(0,k-2)+"..");return f+"<a "+Qa.join(" ")+">"+a+"</a>"+V})}b=b||{};var e=C.htmlRegex,f=C.matcherRegex,g="newWindow"in b?b.newWindow:!0,d="stripPrefix"in b?b.stripPrefix:!0,k=b.truncate,l="twitter"in b?b.twitter:!0,h="email"in b?b.email:!0,p="urls"in b?b.urls:!0,n,r=0,q,m="",s=
0;for(;null!==(n=e.exec(a));){var t=n[0],u=n[2],v=!!n[1];q=a.substring(r,n.index);r=n.index+t.length;"a"===u?v?(s--,0===s&&(m+=q)):(s++,m+=c(q)):0===s&&(m+=c(q));m+=t}r<a.length&&(m+=c(a.substring(r)));return m},matcherRegex:/((^|\s)@(\w{1,15}))|((?:[\-;:&=\+\$,\w\.]+@)[A-Za-z0-9\.\-]*[A-Za-z0-9\-]\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b)|((?:(?:(?:[A-Za-z]{3,9}:(?:\/\/)?)[A-Za-z0-9\.\-]*[A-Za-z0-9\-])|(?:(?:www\.)[A-Za-z0-9\.\-]*[A-Za-z0-9\-])|(?:[A-Za-z0-9\.\-]*[A-Za-z0-9\-]\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b))(?:[-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#\/%=~_()|])?)/g},
ca=function(){var a,b,c={};b=window.navigator.userAgent.toLowerCase();c.ios=function(){return c.iphone()||c.ipod()||c.ipad()};c.iphone=function(){return a("iphone")};c.ipod=function(){return a("ipod")};c.ipad=function(){return a("ipad")};c.android=function(){return a("android")};c.androidPhone=function(){return c.android()&&a("mobile")};c.androidTablet=function(){return c.android()&&!a("mobile")};c.blackberry=function(){return a("blackberry")||a("bb10")||a("rim")};c.blackberryPhone=function(){return c.blackberry()&&
!a("tablet")};c.blackberryTablet=function(){return c.blackberry()&&a("tablet")};c.windows=function(){return a("windows")};c.windowsPhone=function(){return c.windows()&&a("phone")};c.windowsTablet=function(){return c.windows()&&a("touch")};c.fxos=function(){return(a("(mobile;")||a("(tablet;"))&&a("; rv:")};c.fxosPhone=function(){return c.fxos()&&a("mobile")};c.fxosTablet=function(){return c.fxos()&&a("tablet")};c.meego=function(){return a("meego")};c.mobile=function(){return c.androidPhone()||c.iphone()||
c.ipod()||c.windowsPhone()||c.blackberryPhone()||c.fxosPhone()||c.meego()};c.tablet=function(){return c.ipad()||c.androidTablet()||c.blackberryTablet()||c.windowsTablet()||c.fxosTablet()};c.portrait=function(){return 90!==Math.abs(window.orientation)};c.landscape=function(){return 90===Math.abs(window.orientation)};c.detect=function(){if(c.ios()){if(c.ipad())return"tablet";if(c.iphone()||c.ipod())return"mobile"}else return c.android()?c.androidTablet()?"tablet":"mobile":c.blackberry()?c.blackberryTablet()?
"tablet":"mobile":c.windows()?c.windowsTablet()?"tablet":c.windowsPhone()?"mobile":"desktop":c.fxos()?c.fxosTablet()?"tablet":"mobile":c.meego()?"mobile":"desktop"};a=function(a){return-1!==b.indexOf(a)};return c}();(function(a,b){return b?{get:function(c){return a[c]&&b.parse(a[c])},set:function(c,e){a[c]=b.stringify(e)}}:{}})(this.localStorage||{},K);var E=function(a){for(a=3;a--;)try{return new (this.XMLHttpRequest||ActiveXObject)(["Msxml2","Msxml3","Microsoft"][a]+".XMLHTTP")}catch(b){}},p=function(){var a=
function(){return a.get.apply(a,arguments)},b=a.utils={isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},isPlainObject:function(a){return!!a&&"[object Object]"===Object.prototype.toString.call(a)},toArray:function(a){return Array.prototype.slice.call(a)},getKeys:Object.keys||function(a){var b=[],c="";for(c in a)a.hasOwnProperty(c)&&b.push(c);return b},escape:function(a){return String(a).replace(/[,;"\\=\s%]/g,function(a){return encodeURIComponent(a)})},
retrieve:function(a,b){return null==a?b:a}};a.defaults={};a.expiresMultiplier=86400;a.set=function(a,c,e){if(b.isPlainObject(a))for(var f in a)a.hasOwnProperty(f)&&this.set(f,a[f],c);else{e=b.isPlainObject(e)?e:{expires:e};f=void 0!==e.expires?e.expires:this.defaults.expires||"";var g=typeof f;"string"===g&&""!==f?f=new Date(f):"number"===g&&(f=new Date(+new Date+1E3*this.expiresMultiplier*f));""!==f&&"toGMTString"in f&&(f=";expires="+f.toGMTString());var g=(g=e.path||this.defaults.path)?";path="+
g:"",d=e.domain||this.defaults.domain,d=d?";domain="+d:"";e=e.secure||this.defaults.secure?";secure":"";document.cookie=b.escape(a)+"="+b.escape(c)+f+g+d+e}return this};a.remove=function(a){a=b.isArray(a)?a:b.toArray(arguments);for(var c=0,e=a.length;c<e;c++)this.set(a[c],"",-1);return this};a.empty=function(){return this.remove(b.getKeys(this.all()))};a.get=function(a,c){c=c||void 0;var e=this.all();if(b.isArray(a)){for(var f={},g=0,d=a.length;g<d;g++){var k=a[g];f[k]=b.retrieve(e[k],c)}return f}return b.retrieve(e[a],
c)};a.all=function(){if(""===document.cookie)return{};for(var a=document.cookie.split("; "),b={},c=0,A=a.length;c<A;c++){var e=a[c].split("=");b[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return b};a.enabled=function(){if(navigator.cookieEnabled)return!0;var b="_"===a.set("_","_").get("_");a.remove("_");return b};return a}(),r=window,z=document,f=null,k=null,b={},c={},t={},Z=[];b.session={};var ea=r.document.title,q={base_ready:{begin:0,max:30},all_ready:{begin:0,max:60},io:{begin:0,max:30}},
v={},y={},H=0,g=function(a,b){t.socket&&t.socket.connected?t.emit(a,b):Z.push({channel:a,data:b})},G=function(){if(0<Z.length){var a=f.clone(Z);Z=[];f.each(a,function(a){t.emit(a.channel,a.data)})}},da=function(){t.socket&&t.socket.connected&&t.disconnect()},B="none",N=function(){var a=b.session,c=a.agents_rated||{},f=a.agent||a.last_agent||"";f&&!c[f]&&(c[f]="good",a.agents_rated=c,e.find(".rate-good").addClass("rated"),g("cev",{ev:"rate",value:"good",time:D()}))},T=function(){var a=b.session,c=
a.agents_rated||{},f=a.agent||a.last_agent||"";f&&!c[f]&&(c[f]="bad",a.agents_rated=c,e.find(".rate-bad").addClass("rated"),g("cev",{ev:"rate",value:"bad",time:D()}))},U=function(){var a=b.visitor,A=a.name||"",e=a.email||"",a=a.phone||"",f=l.find("#v_department_offline").val(),d=l.find("#v_message_offline").val(),h=!0,n=b.widget.offline_survey||{};"active"!=n.department.status||1!=n.department.is_require||f?(l.find("#v_department_offline").removeClass("form-error"),l.find("#error_department_offline").hide()):
(h=!1,l.find("#v_department_offline").addClass("form-error"),l.find("#error_department_offline").show());d?l.find("#v_message_offline").removeClass("form-error"):(h=!1,l.find("#v_message_offline").addClass("form-error"));h?(A={ev:"message_offline",name:A,email:e,phone:a,department:f,message:d,url:r.location.href,time:D()},"offline"==c._status_account?(e=c.url_sock_p+"ev/message_offline",A.aid=c.aid,A.vid=p.get("__sbzid")||"",A.sid=p.get("__sbzsid")||"",Fa(e,k.param(A),function(a){})):g("cev",A),qa("hide"),
ra("show"),l.find("#v_message_offline").val("")):F("offline")},s=function(){var a=b.widget.offline_survey||{},A=l.find("#v_name_offline").val(),e=l.find("#v_email_offline").val(),f=l.find("#v_phone_offline").val(),d=l.find("#v_department_offline_edit").val(),h=l.find("#v_message_offline_edit").val(),n=!0;"active"!=a.name.status||1!=a.name.is_require||A?(l.find("#v_name_offline").removeClass("form-error"),l.find("#error_name_offline").hide()):(n=!1,l.find("#v_name_offline").addClass("form-error"),
l.find("#error_name_offline").show());"active"!=a.email.status||1!=a.email.is_require&&!e||ua(e)?(l.find("#v_email_offline").removeClass("form-error"),l.find("#error_email_offline").hide()):(n=!1,l.find("#v_email_offline").addClass("form-error"),l.find("#error_email_offline").show());"active"!=a.phone.status||1!=a.phone.is_require||f?(l.find("#v_phone_offline").removeClass("form-error"),l.find("#error_phone_offline").hide()):(n=!1,l.find("#v_phone_offline").addClass("form-error"),l.find("#error_phone_offline").show());
"active"!=a.department.status||1!=a.department.is_require||d?(l.find("#v_department_offline_edit").removeClass("form-error"),l.find("#error_department_edit_offline").hide()):(n=!1,l.find("#v_department_offline_edit").addClass("form-error"),l.find("#error_department_edit_offline").show());h?l.find("#v_message_offline_edit").removeClass("form-error"):(n=!1,l.find("#v_message_offline_edit").addClass("form-error"));n?(a={ev:"message_offline",name:A,email:e,phone:f,department:d,message:h,url:r.location.href,
time:D()},"offline"==c._status_account?(d=c.url_sock_p+"ev/message_offline",a.aid=c.aid,a.vid=p.get("__sbzid")||"",a.sid=p.get("__sbzsid")||"",Fa(d,k.param(a),function(a){})):g("cev",a),u("name",A),u("email",e),u("phone",f),va("hide"),ra("show"),l.find("#v_message_offline_edit").val("")):F("offline")},Ba=function(){var a=b.widget.survey,c=e.find("#v_department_survey").val(),f=e.find("#v_name_survey").val(),d=e.find("#v_email_survey").val(),k=e.find("#v_phone_survey").val(),l=e.find("#v_question_survey").val(),
n=!0;"active"!=a.department.status||1!=a.department.is_require||c?(e.find("#v_department_survey").removeClass("form-error"),e.find("#error_department_survey").hide()):(n=!1,e.find("#v_department_survey").addClass("form-error"),e.find("#error_department_survey").show());"active"!=a.name.status||1!=a.name.is_require||f?(e.find("#v_name_survey").removeClass("form-error"),e.find("#error_name_survey").hide()):(n=!1,e.find("#v_name_survey").addClass("form-error"),e.find("#error_name_survey").show());"active"!=
a.email.status||1!=a.email.is_require&&!d||ua(d)?(e.find("#v_email_survey").removeClass("form-error"),e.find("#error_email_survey").hide()):(n=!1,e.find("#v_email_survey").addClass("form-error"),e.find("#error_email_survey").show());"active"!=a.phone.status||1!=a.phone.is_require||k?(e.find("#v_phone_survey").removeClass("form-error"),e.find("#error_phone_survey").hide()):(n=!1,e.find("#v_phone_survey").addClass("form-error"),e.find("#error_phone_survey").show());"active"==a.question.status&&1==a.question.is_require&&
l&&e.find(".type_message textarea").val(l);n?(a={ev:"survey",department:c||"",name:f||"",email:d||"",phone:k||"",time:D()},g("cev",a),a.department&&(b.session.department=c),a.phone&&u("phone",k),a.name&&u("name",f),a.email&&u("email",d),$("hide"),aa("show")):F("online")},M=function(){var a=e.find("#v_name_contact").val(),b=e.find("#v_email_contact").val(),c=!0;a?e.find("#v_name_contact").removeClass("form-error"):(c=!1,e.find("#v_name_contact").addClass("form-error"));ua(b)?e.find("#v_email_contact").removeClass("form-error"):
(c=!1,e.find("#v_email_contact").addClass("form-error"));c&&(c={ev:"edit_contact",name:a,email:b,time:D()},g("cev",c),u("name",a),u("email",b),wa("hide"),xa("show"))},la=function(){n("save email transcript");var a=e.find("#v_email_transcript").val();if(ua(a)){e.find("#v_email_transcript").removeClass("form-error");var b={ev:"email_transcript",email:a,time:D()};g("cev",b);u("email",a);W("hide")}else e.find("#v_email_transcript").addClass("form-error")},R=function(a){n("Typing...");var A=b.session;
13===a.which?(a.preventDefault(),a=e.find(".type_message textarea").val(),n(a),a&&"offline"!=c.status_account&&(ma("",f.escape(a)),ya("hide"),g("cev",{ev:"chat",message:a,url:r.location.href,time:D()}),e.find(".type_message textarea").val(""),A.is_typing=!1,A.agent&&Ea("SUBIZ Chat","Visitor chat",A.agent),f.isEmpty(b.triggers)||Q("chat_message"))):A.is_typing||(A.is_typing=!0,A={ev:"chatstates",state:"composing",time:D()},g("cev",A))},P=function(){var a=e.find(".notice_new_message").html(),a=parseInt(a,
10);return 0<a?a:0},Ca=function(){if(c.is_expand)"online"==c.status_widget?La():Ma();else{var a=b.session;a.is_expand&&1==a.is_expand&&(c.is_expand=1,"online"==c.status_widget?e.find(".button_chat_online").click():l.find(".button_chat_offline").click())}if(a=p.get("__sbzlts")){p.set("__sbzlts","",{path:"/",expires:-1});try{a=K.parse(a),f.isObject(a)&&(n(a),y=a)}catch(A){}}if(a=p.get("__sbzlnm"))p.set("__sbzlnm","",{path:"/",expires:-1}),Ra(a),F("online");a=p.get("__sbzsound");if("on"==a||"off"==a)p.set("__sbzsound",
"",{path:"/",expires:-1}),b.session.sound=a,Sa(a)},h=function(){if(b.session.slot){g("cev",{ev:"presence_status"});var a=D(),c=new Date(b.visitor_session.time.start),a=a-Math.floor((c.getTime()+6E4*c.getTimezoneOffset())/1E3);time=18E5<a?6E5:9E5<a?18E4:6E4;108E5>a&&setTimeout(h,time)}},Q=function(a){var c=b.session,e=b.visitor_session,f=b.visitor;k.each(b.triggers,function(b,d){n("trigger data");n(d);n("trigger_id : "+d.id);var l=sa(d.data.condition);n("trigger_type : "+l);"undefined"==typeof y[d.id]&&
(y[d.id]="-1");var h=y[d.id];n("trigger_result : "+h);if(d.data.event==a){if("once"==l){if(("1"==h||"0"==h)&&d.fire_once)return!0}else if("limit"==l){if("1"==h&&d.fire_once)return!0}else if("unlimited"==l&&"1"==h&&d.fire_once)return!0;n("Checking conditions...");var p=d.data.condition[0],m=d.data.condition.slice(1),q=null;n("condition",m);k.each(m,function(a,b){n("trigger condition");n(m[a]);if("and"==p&&!1===q||"or"==p&&!0===q)return!1;var d="",g=m[a][2];if("@hour_of_day"==m[a][1])d=(new Date).getHours(),
g=parseInt(g,10);else if("@day_of_week"==m[a][1])d=(new Date).getDay(),g=parseInt(g,10);else if("@visitor_time_on_site"==m[a][1]){var d=0,k=new Date(e.time.start);k&&(d=D()-Math.floor(k.getTime()/1E3),d=parseInt(Math.round(d),10));g=parseInt(g,10)}else"@visitor_ip"==m[a][1]?d=e.ip:"@visitor_city"==m[a][1]?(d=c.geo.city,d=d.toLowerCase(),g=g.toLowerCase()):"@visitor_country_code"==m[a][1]?(d=c.geo.country,d=d.toLowerCase(),g=g.toLowerCase()):"@visitor_country_name"==m[a][1]?(d=c.geo.country_name,d=
d.toLowerCase(),g=g.toLowerCase()):"@visitor_page_url"==m[a][1]?(d=r.location.href,d=d.replace(/^(http:\/\/|https:\/\/)/gi,""),g=g.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_page_title"==m[a][1]?d=document.title:"@visitor_page_count"==m[a][1]?(d=e.page_visited.length,g=parseInt(g,10)):"@referrer"==m[a][1]?(d=document.referrer,d=d.replace(/^(http:\/\/|https:\/\/)/gi,""),g=g.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_name"==m[a][1]?d=f.name||"":"@visitor_email"==m[a][1]?d=f.email||"":
"@visitor_phone"==m[a][1]?d=f.phone||"":"@visitor_referrer"==m[a][1]?(d=e.v.referrer,d=d.replace(/^(http:\/\/|https:\/\/)/gi,""),g=g.replace(/^(http:\/\/|https:\/\/)/gi,"")):"@visitor_search_engine"==m[a][1]?d=e.se&&e.se.name?e.se.name:"":"@visitor_search_terms"==m[a][1]?d=e.se&&e.se.kw?e.se.kw:"":"@visitor_type"==m[a][1]?(d=e.v.type,g=g.toLowerCase()):"@visitor_device"==m[a][1]?(d=ca.detect()||"desktop",g=g.toLowerCase()):"@visitor_label"==m[a][1]&&(d=f.labels||[]);q=w(d,m[a][0],g);n(d+" "+m[a][0]+
" "+g+" = "+q)});!0===q?(y[d.id]="1",S(d),g("cev",{ev:"trigger_result",id_trigger:d.id,status:"success",time:D()}),"undefined"!=typeof v[d.id]&&null!==v[d.id]&&clearTimeout(v[d.id])):!1===q&&(y[d.id]="0","undefined"!=typeof v[d.id]&&null!==v[d.id]&&clearTimeout(v[d.id]),v[d.id]=setTimeout(function(){n("run triggers again : "+a);Q(a)},2E4))}})},w=function(a,b,c){return"eq"==b?f.isArray(a)?f.contains(a,c)?!0:!1:a===c?!0:!1:"neq"==b?a!==c?!0:!1:"lt"==b?a<c?!0:!1:"gt"==b?a>c?!0:!1:"lte"==b?a<=c?!0:!1:
"gte"==b?a>=c?!0:!1:"icontains"==b?(a=(a+"").indexOf(c,0),-1===a?!1:!0):"nicontains"==b?(b=new RegExp(c,"g"),a=b.test(a),!1===a?!0:!1):"iregex"==b?(b=new RegExp(c,"gi"),(a=b.test(a))?!0:!1):"true"==b?!0===a?!0:!1:"false"==b?!1===a?!0:!1:!1},S=function(a){k.each(a.data.actions,function(A,d){n("run trigger action");n(d);if("autoInvite"==d[0]||"sendMessageToVisitor"==d[0]){if("offline"==c.status_account||"offline"==c.status_widget)return!1;if("autoInvite"==d[0]){var k=e.find(".line_message").length,
l=b.session;if(!l.slot||0<k||l.agent)return!1}else{var h=0;0==e.find(".supporter_chat, visitor_chat").length&&(h=1)}if(!f.isString(d[1][0])||!f.isString(d[1][1]))return!1;k={name:d[1][0],avatar:d[1][1]};l=d[2];g("cev",{ev:"trigger_message",from:k,message:l,id_trigger:a.id,url:r.location.href,time:D()});ma(k,l);ya("hide");e.find(".avatar_supporter img").attr("src",O(k.avatar));e.find(".name_supporter").html(f.escape(k.name));"offline"==c.status_widget&&(c.status_widget="online",X("hide"),Y("show"));
"survey"==c.widget_window?($("hide"),aa("show")):"online_compress"==c.widget_window&&("autoInvite"==d[0]?e.find(".button_chat_online").click():h?e.find(".button_chat_online").click():($a(),F("online")));ab();bb()}else"applyToLabel"==d[0]?(g("cev",{ev:"add_label",labels:d[1],id_trigger:a.id,url:r.location.href,time:D()}),f.each(d[1],function(a){Ea("Subiz Labels","TriggerAddLabel",a)})):"removeToLabel"==d[0]&&(g("cev",{ev:"remove_label",labels:d[1],id_trigger:a.id,url:r.location.href,time:D()}),f.each(d[1],
function(a){Ea("Subiz Labels","TriggerRemovedLabel",a)}))})},sa=function(a){if(void 0!==a&&null!==a&&0<a.length)var b=a[0];else return!1;a=a.slice(1);var c="@visitor_ip @visitor_city @visitor_country_code @visitor_country_name @visitor_name @visitor_referrer @visitor_search_engine @visitor_search_terms @visitor_type".split(" "),e=["@hour_of_day","@day_of_week","@visitor_time_on_site","@visitor_page_count"],f=["@visitor_page_url","@visitor_page_title","@referrer"],d=0,g=0,l=0;for(x in a)-1<k.inArray(a[x][1],
c)?d++:-1<k.inArray(a[x][1],e)?g++:-1<k.inArray(a[x][1],f)&&l++;if("and"==b||"or"==b)return 0<l?"unlimited":0<g?"limit":"once"},ta=function(){var a={widget:c.status_widget,account:c.status_account,department:"",agent:""},e=b.session;e.department&&f.each(b.departments,function(b){b.name==e.department&&(a.department=b.status)});e.agent&&f.each(b.agents,function(b){b.username==e.agent&&(a.agent="offline"==b.state?"offline":"online")});return a},oa=function(){var a=b.session.department||"";if("online"==
c.status_widget)var d=e.find("#department select").val();else d=l.find("#department select").val(),f.isEmpty(d)&&(d=l.find("#department_edit select").val());f.isEmpty(d)||(a=d);var g='<option value="">'+b.lang.online.department_help+"</option>";f.each(b.departments,function(a){"online"==a.status&&(g+='<option value="'+f.escape(a.name)+'">'+f.escape(a.name)+"</option>")});e.find("#department select").html(g);g='<option value="">'+b.lang.online.department_help+"</option>";f.each(b.departments,function(a){g+=
'<option value="'+f.escape(a.name)+'">'+f.escape(a.name)+"</option>"});l.find("#department select").html(g);l.find("#department_edit select").html(g);f.isEmpty(a)||(a=f.escape(a),e.find('#department select option[value="'+a+'"]').attr("selected","selected"),l.find('#department select option[value="'+a+'"]').attr("selected","selected"),l.find('#department_edit select option[value="'+a+'"]').attr("selected","selected"))},u=function(a,c){if("undefined"==typeof c||!c)return!1;var d=b.visitor,g=f.escape(c);
"name"==a?(d.name=c,e.find(".v_name").val(c),l.find(".v_name").val(c),e.find(".v_name_text").html(g),l.find(".v_name_text").html(g),e.find(".visitor_name").html(g)):"email"==a?(d.email=c,e.find(".v_email").val(c),l.find(".v_email").val(c),e.find(".v_email_text").html(g),l.find(".v_email_text").html(g)):"phone"==a&&(d.phone=c,e.find(".v_phone").val(c),l.find(".v_phone").val(c))},m=function(){l.find(".notification_widget").remove();e.find(".notification_widget").remove();if("online"==c.status_account){X("hide");
Y("show");fa("hide");ba("hide");ga("show");var a=ta(),d=!1;"offline"==a.agent&&"offline"==a.department&&(d=!0);"active"==b.widget.survey.status&&d&&1>b.history.length?(aa("hide"),$("show")):($("hide"),aa("show"))}else Y("hide"),X("show"),ha("hide"),ia("show"),ra("hide"),Ga("show");ja("enable");c.status_widget=c.status_account},I=function(){b.session.department?m():ja("enable")},La=function(){fa("hide");ba("hide");ga("show");var a=!1;if("active"==b.widget.survey.status){var a=!0,c=e.find(".line_message").length;
if(b.session.agent||0<c)a=!1}a?(aa("hide"),$("show")):($("hide"),aa("show"));Ra(0)},Ma=function(){ha("hide");ia("show");ra("hide");Ga("show")},sb=function(){n("io ready");var a=p.get("__sbzid","");if("offline"==c._status_account){var d=p.get("__sbzsid")||"",d=["aid="+c.aid,"vid="+a,"sid="+d,"url="+encodeURIComponent(r.location.href),"title="+encodeURIComponent(z.title),"referer="+encodeURIComponent(z.referrer)];Fa(c.url_sock_p+"ev/init",d.join("&"),function(a){a=K.parse(a);f.each(a,function(a){J(a)})})}else t=
io.connect(c.url_socket,{"max reconnection attempts":18,"sync disconnect on unload":!1,"connect timeout":5E3,"reconnection limit":4E3}),t.on("sev",J),t.on("connect",function(){n("socket connected");c.socket_connected=t.socket.connected;c.socket_connecting=t.socket.connecting;b.all_ready||t.emit("cev",{ev:"init",aid:c.aid,vid:a,url:r.location.href,title:z.title,referer:z.referrer})}),t.on("reconnect_failed",function(a){n("socket reconnect failed")}),t.on("reconnect",function(a){n("socket reconnected");
ja("enable");G();c.click_reconnect&&(delete c.click_reconnect,e.find(".notification_reconnecting").remove(),l.find(".notification_reconnecting").remove(),I())}),t.on("reconnecting",function(a,e){n("socket reconnecting");c.socket_connected=t.socket.connected;c.socket_connecting=t.socket.connecting;var d=Math.floor((new Date).getTime()/1E3);n("attempting reconnect - "+e+" - "+(d-H)+" s");60<d-H&&(n("reconnect timeout - show notification"),b.session&&b.session.agent&&Da(),ja("disable"),na('Lost connection! <a href="javascript:;" class="link_reconnect">Click here</a> to try reconnect.'))}),
t.on("error",function(a){n("socket error")}),t.on("disconnect",function(){n("socket disconnect");c.socket_connected=t.socket.connected;c.socket_connecting=t.socket.connecting;H=Math.floor((new Date).getTime()/1E3)})},J=function(a){n(a);if("set_id"==a.ev){var d=p.get("__sbzid","");a.vid&&a.vid!=d&&(n("visitor is new : set cookie __sbzid"),p.set("__sbzid",a.vid,{expires:365,path:"/"}));p.set("__sbzsid",a.sid,{path:"/"})}else if("init:full"==a.ev)b.session=a.session||{},b.triggers=a.account.triggers||
[],b.agents=a.account.agents||[],b.departments=a.account.departments||[],b.history=a.history||[],b.visitor=a.session.visitor||{},b.visitor_session=a.session.visitor_session||{},d=p.get("__sbzid",""),a.session.vid&&a.session.vid!=d&&(n("visitor is new : set cookie __sbzid"),p.set("__sbzid",a.session.vid,{expires:365,path:"/"})),Za(ub);else if("chat"==a.ev){var g=b.session,d=a.from.split("@")[0],h=pa(d);if(h){var m=0;g.agent||(m=1,g.agent=d,Ta("show"),Ha("show"),Ia("show"),Ua("show"),d=b.lang.other.agent_join_chat,
d=d.replace("{agent}",h.name),na(d),c.status_account="online",e.find(".type_message textarea").prop("disabled")&&ja("enable"));e.find(".avatar_supporter img").attr("src",O(h.avatar));e.find(".name_supporter").html(f.escape(h.name));e.find(".text_supporter").html(f.escape(h.job_title));ma(h,a.message);ya("hide");"offline"==c.status_widget&&(c.status_widget=c.status_account,X("hide"),Y("show"),fa("hide"),ga("show"),ba("hide"),$("hide"),aa("show"));"survey"==c.widget_window?($("hide"),aa("show")):"online_compress"==
c.widget_window&&($a(),F("online"),m&&e.find(".button_chat_online").click());ab();bb();Ea("SUBIZ Chat","Agent chat",g.agent)}}else if("change_state"==a.ev){var g=b.session,q="",r="offline";if(q=pa(a.agent)){f.each(b.agents,function(c){c.username==a.agent&&(c.state=a.state,q=c);"online"==c.state&&("active"==b.widget.survey.status&&"active"==b.widget.survey.department?0<c.departments.length&&(r="online"):r="online");"away"==c.state&&c.username==g.agent&&(r="online")});f.isEmpty(b.departments)||(f.each(b.departments,
function(a,c){a.status="offline";f.each(b.agents,function(b){"online"==b.state&&0<b.departments.length&&f.contains(b.departments,a.name)&&(a.status="online")})}),oa());c.status_account=r;h=ta();m=c.widget_window;"offline"==h.widget&&(!g.department&&"online"==h.account||g.department&&"online"==h.department)&&("offline_compress"==m?(X("hide"),Y("show"),ga("hide"),fa("show")):(d=b.lang.other.agent_online,d=d.replace("{agent}",q.name),Va(d,"account_online")));if("online"==h.widget&&"offline"==h.account)if("online_compress"==
m){if(0<P())return;Y("hide");X("show");ia("hide");ha("show")}else ja("disable"),Va(b.lang.other.agent_offline,"account_offline");c.status_widget=r;g.agent&&"offline"==a.state&&(Da(),ja("disable"))}else n("change_state - agent not in list")}else if("agent_connection"==a.ev){if(g=b.session,g.agent&&g.agent==a.agent&&(q=pa(a.agent)))"disconnect"==a.state?(d=b.lang.other.agent_disconnect,d=d.replace("{agent}",q.name),na(d)):"connect"==a.state&&(d=b.lang.other.agent_reconnect,d=d.replace("{agent}",q.name),
na(d))}else if("chatstates"==a.ev)g=b.session,d=a.from.split("@")[0],g.agent&&g.agent==d&&("composing"==a.state?Ja("show",d):"paused"==a.state&&Ja("hide"));else if("sync"==a.ev)a.name&&u("name",a.name),a.email&&u("email",a.email),a.phone&&u("phone",a.phone),a.message&&(ma("",a.message),ya("hide"),X("hide"),Y("show"),e.find(".button_chat_online").click()),"undefined"!=typeof a.is_expand&&(d=1==a.is_expand?"hide":"show",h=1==a.is_expand?"show":"hide",c.is_expand=parseInt(a.is_expand,10),"online"==c.status_widget?
(fa(d),ga(h)):(ha(d),ia(h)));else if("block"==a.ev)k(".sbzon").remove(),k(".sbzoff").remove(),da(),p.set("__sbzbl","1",{path:"/",expires:365});else if("transfer"==a.ev){if(g=b.session,h=pa(g.agent))d=b.lang.other.agent_left_chat,d=d.replace("{agent}",h.name),Da({message:d}),g.last_agent=g.agent,delete g.agent,delete g.department,I(),Ja("hide")}else if("end_chat"==a.ev){if(g=b.session,h=pa(g.agent))g.last_agent=g.agent,delete g.agent,d=b.lang.other.agent_end_chat,d=d.replace("{agent}",h.name),na(d),
Ja("hide")}else"full_slot"==a.ev&&(h=b.session.visitor,d="",(m=e.find(".visitor_content_chat").last())&&(d=m.text()),d&&(h.name||h.email?l.find("#v_message_offline").val(d):l.find("#v_message_offline_edit").val(d)),Y("hide"),X("show"),ha("hide"),ia("show"),Ga("show"))},Na=function(a){var c=new Date;if(0<q.base_ready.begin){if(seconds=(c.getTime()-q.base_ready.begin)/1E3,seconds=parseInt(Math.round(seconds),10),seconds>q.base_ready.max)return n("base_ready timeout : base_ready"),clearTimeout(q.base_ready.id),
!0}else q.base_ready.begin=c.getTime();b.css_ready&&b.js_ready&&b.html_ready?(n("base ready : callback"),a()):q.base_ready.id=setTimeout(function(){n("base not ready : check again");Na(a)},200)},Oa=function(a,c){q[a]||(q[a]={begin:0,max:5});var d=new Date;if(0<q[a].begin){if(seconds=(d.getTime()-q[a].begin)/1E3,seconds=parseInt(Math.round(seconds),10),seconds>q[a].max)return n("wait base_ready timeout : "+a),clearTimeout(q[a].id),!0}else q[a].begin=d.getTime();b.base_ready?(n("base ready : callback"),
c()):q[a].id=setTimeout(function(){n("base not ready : check again");Oa(a,c)},200)},Pa=function(a,c){q[a]||(q[a]={begin:0,max:30});var d=new Date;if(0<q[a].begin){if(seconds=(d.getTime()-q[a].begin)/1E3,seconds=parseInt(Math.round(seconds),10),seconds>q[a].max)return n("wait all_ready timeout : "+a),clearTimeout(q[a].id),!0}else q[a].begin=d.getTime();b.all_ready?(n("all ready : callback"),c()):q[a].id=setTimeout(function(){n("all not ready : check again");Pa(a,c)},500)},Za=function(a){var c=new Date;
if(0<q.all_ready.begin){if(seconds=(c.getTime()-q.all_ready.begin)/1E3,seconds=parseInt(Math.round(seconds),10),seconds>q.all_ready.max)return n("all_ready timeout : all_ready"),clearTimeout(q.all_ready.id),da(),!0}else q.all_ready.begin=c.getTime();b.base_ready?(n("all ready : callback"),b.all_ready=!0,a()):q.all_ready.id=setTimeout(function(){n("all not ready : check again");Za(a)},200)},tb=function(){var a={config:c,lang:b.lang};b.html.online=f.template(b.html.online,a);b.html.offline=f.template(b.html.offline,
a);var a=["online","offline"],d=a.length;f.each(a,function(a){var h="online"==a?"sbzon":"sbzoff",m=f.template(b.html.iframe,{name:h});(function(a,f,h){h=k(h);h.find("iframe").attr("src","javascript:false");h.appendTo("body");h=h.find("iframe")[0].contentWindow.document;h.write("<!DOCTYPE html><html><head></head><body></body></html>");h.close();setTimeout(function(){var h={"margin-top":"0px","margin-right":"0px","margin-bottom":"0px",padding:"0px",border:"0px","background-color":"rgba(0, 0, 0, 0)",
overflow:"hidden",position:"fixed","z-index":"16000001",bottom:"0px",display:"block",width:"310px",height:"431px"};h["left"==c.position?"left":"right"]="10px";k("."+f).css(h);h=k("#"+f+"_frame").contents();"online"==a?e=h:"offline"==a&&(l=h);h.find("head").append("<style>"+b.css+"</style>");h.find("body").append(k(b.html[a]));d--;0==d&&(b.base_ready=!0);b.base_ready&&("online"==c.status_widget?(X("hide"),Y("show"),ga("hide"),fa("show")):(Y("hide"),X("show"),ia("hide"),ha("show")),b.widget.theme.url_twitter&&
(e.find("#twitter a").attr("href",b.widget.theme.url_twitter),e.find("#twitter").show(),l.find("#twitter a").attr("href",b.widget.theme.url_twitter),l.find("#twitter").show()),b.widget.theme.url_facebook&&(e.find("#facebook a").attr("href",b.widget.theme.url_facebook),e.find("#facebook").show(),l.find("#facebook a").attr("href",b.widget.theme.url_facebook),l.find("#facebook").show()),"active"==b.widget.theme.logo_status&&b.widget.theme.logo_image&&(e.find(".logo_company img").attr("src",O(b.widget.theme.logo_image)),
e.find(".logo_company").show()),"off"==p.get("__sbzbubble")&&(c.bubble="off",ba("hide")),"active"==b.widget.chat_bubble.status&&(e.find("#bubble_image img").attr("src",O(b.widget.chat_bubble.image)),e.find("#bubble_image img").load(function(){n("bubble",c.bubble);c.bubble&&"off"==c.bubble||(ba("show"),F("online"));c.is_expand&&ba("hide")}),e.find("#bubble_image").click(function(){e.find(".button_chat_online").click()}),e.find("#bubble_close").click(function(){ba("hide");c.bubble="off";p.set("__sbzbubble",
c.bubble,{path:"/"})})),h=k("#subiz_status, .subiz_status"),0<h.length&&("online"==c.status_account?h.html(b.widget.chat_button.online_code):h.html(b.widget.chat_button.offline_code),k(z).on("click","#subiz_status, .subiz_status",function(){"online"==c.status_account?c.is_expand||La():c.is_expand||Ma()})),e.find(".button_chat_online").click(function(){c.is_expand||g("cev",{ev:"sync",is_expand:1,time:D()});c.is_expand=1;b.all_ready?(n("click expand widget - all ready"),La(),c.chat_requested||(c.chat_requested=
1,Q("chat_requested"))):(n("click expand widget - all NOT ready"),e.find("#subiz_loading").is(":hidden")&&(n("click expand widget - show loading"),$("hide"),aa("hide"),eb("show"),fa("hide"),ga("show")));"active"==b.widget.chat_bubble.status&&ba("hide")}),e.find(".online_heading").click(function(){c.is_expand=0;g("cev",{ev:"sync",is_expand:0,time:D()});ga("hide");fa("show");"active"!=b.widget.chat_bubble.status||c.bubble&&"off"==c.bubble||(ba("show"),F("online"))}),l.find(".button_chat_offline").click(function(){c.is_expand||
g("cev",{ev:"sync",is_expand:1,time:D()});c.is_expand=1;b.all_ready?(n("click expand widget offline - all ready"),Ma()):(n("click expand widget offline - all NOT ready"),l.find("#subiz_loading").is(":hidden")&&(n("click expand widget offline - show loading"),ra("hide"),Ga("hide"),fb("show"),ha("hide"),ia("show")))}),l.find(".offline_heading").click(function(){c.is_expand=0;g("cev",{ev:"sync",is_expand:0,time:D()});ia("hide");ha("show")}))},50)})(a,h,m)})},ub=function(){n("Yes! Let's go!");var a=b.widget.survey,
d=b.widget.offline_survey||{};f.isEmpty(b.departments)&&(a.department.status="inactive",d.department.status="inactive");"active"==a.status&&("active"==a.name.status?gb("show"):gb("hide"),"active"==a.email.status?hb("show"):hb("hide"),"active"==a.phone.status?ib("show"):ib("hide"),"active"==a.question.status?jb("show"):jb("hide"),"active"==a.department.status?(n("fill data department"),oa(),kb("show")):kb("hide"));"active"==d.name.status?lb("show"):lb("hide");"active"==d.email.status?mb("show"):mb("hide");
"active"==d.phone.status?nb("show"):nb("hide");"active"==d.department.status?(oa(),ob("show")):ob("hide");a=b.visitor;a.name&&u("name",a.name);a.email&&u("email",a.email);a.phone&&u("phone",a.phone);var q=b.session;q.agent?(f.each(b.agents,function(a){a.username==q.agent&&(e.find(".avatar_supporter img").attr("src",O(a.avatar)),e.find(".name_supporter").html(f.escape(a.name)),e.find(".text_supporter").html(f.escape(a.job_title)))}),f.each(q.agents_rated,function(a,b){"good"==a?e.find(".rate-good").addClass("rated"):
"bad"==a&&e.find(".rate-bad").addClass("rated")}),Ta("show"),Ha("show"),Ua("show"),Ia("show")):(Ta("hide"),Ha("hide"),Ua("hide"),Ia("hide"));if(0<b.history.length){ya("hide");var V="",v="";f.each(b.history,function(a){"agent"==a.from.type?f.each(b.agents,function(b){b.username==a.from.user&&(V=b,ma(b,f.escape(a.message)))}):"visitor"==a.from.type?ma("",f.escape(a.message)):"trigger"==a.from.type?(v=a.from.user,ma(a.from.user,a.message)):"system"==a.from.type&&na(a.message)});!V&&v&&(V=v);V&&(e.find(".avatar_supporter img").attr("src",
O(V.avatar)),e.find(".name_supporter").html(f.escape(V.name)))}eb("hide");fb("hide");n("restore session");Ca();f.isEmpty(b.triggers)||Q("page_enter");h();e.find(".btn_start_chat").click(Ba);e.find(".btnoption").click(function(){W("toogle")});e.find(".option_config_sound label, .option_config_sound i").click(function(){e.find(".option_config_sound i").hasClass("icon_sound")?(Sa("off"),b.session.sound="off"):(Sa("on"),b.session.sound="on")});e.find("#close_option").click(function(){W("hide")});e.find(".btn_endchat").click(function(){var a=
pa(b.session.agent);if(a){var c=b.lang.online.ec_message,c=c.replace("{agent}",f.escape(a.name));e.find(".endchat_form .endchat_label").html(c);W("hide");za("show");Da();g("cev",{ev:"end_chat",time:D()})}});e.find("#end_chat_footer").click(function(){e.find(".btn_endchat").click()});e.find("#ec_close").click(function(){za("hide")});e.find("#edit_contact").click(function(){Aa("hide");var a=b.visitor;a.name||a.email?(xa("show"),e.find("#v_name_contact_view").show(),a.name||e.find("#v_name_contact_view").hide(),
e.find("#v_email_contact_view").show(),a.email||e.find("#v_email_contact_view").hide()):wa("show")});e.find("#edit_successful").click(M);e.find("#icon_edit_contact").click(function(){xa("hide");wa("show")});e.find("#icon_close_contact").click(function(){W("hide")});e.find("#email_transcript").click(function(){Aa("hide");Wa("show")});e.find("#save_email_transcript").click(la);e.find("#cancel_email_transcript").click(function(){W("hide")});e.find("#cancel_contact").click(function(){W("hide")});e.on("click",
".visitor_name",function(){W("show");Aa("hide");e.find("#edit_contact").click()});e.find("#rate_good").click(N);e.find("#rate_bad").click(T);e.find("#ec_rate_good").click(function(){e.find("#rate_good").click();za("hide")});e.find("#ec_rate_bad").click(function(){e.find("#rate_bad").click();za("hide")});e.find(".type_message textarea").on("keypress",R);e.find(".type_message textarea").on("blur",function(){if(b.session.is_typing){b.session.is_typing=!1;var a={ev:"chatstates",state:"paused",time:D()};
g("cev",a)}});e.on("click",".link_offline",function(){if("offline"==c.status_account){var a=e.find(".type_message textarea").val();l.find(".textarea_offline").val(a)}m()});l.find("#send_message_offline").click(U);l.find("#send_message_offline_edit").click(s);l.find("#icon_edit_contact_offline").click(function(){qa("hide");va("show")});l.find("#v_message_offline").change(function(){var a=l.find("#v_message_offline").val();l.find("#v_message_offline_edit").val(a);l.find("#message_offline_text").html(f.escape(a))});
l.find("#v_message_offline_edit").change(function(){var a=l.find("#v_message_offline_edit").val();l.find("#v_message_offline").val(a);l.find("#message_offline_text").html(f.escape(a))});l.find(".btn_send_another").click(function(){ra("hide");qa("show");l.find("#v_message_offline").val("");l.find("#v_message_offline_edit").val("")});e.on("click",".close_notification_widget",function(){e.find(".chat_warning").has(this).remove()});l.on("click",".close_notification_widget",function(){l.find(".chat_warning").has(this).remove()});
e.on("click",".link_reconnect",function(){c.socket_connected?I():(Va("Reconnecting...","reconnecting"),c.click_reconnect=1,H=Math.floor((new Date).getTime()/1E3),t.socket&&!t.socket.connected&&t.socket.reconnect())});e.on("click",".link_refresh",function(){m()});l.on("click",".link_refresh",function(){m()});e.on("click",".link_chat_again",function(){I()});e.on("click","#ec_chat_again",function(){za("hide");I()});k(r).unload(function(){if(b.all_ready){p.set("__sbzlts",K.stringify(y),{path:"/"});var a=
P();0<a&&p.set("__sbzlnm",a,{path:"/"});b.session&&"off"==b.session.sound&&p.set("__sbzsound","off",{path:"/"});c.bubble&&p.set("__sbzbubble",c.bubble,{path:"/"})}});k(r).on("blur focus",function(a){B=a.type});c.idle_time=0;c.is_idle=0;var db=function(){c.idle_time+=1;5<=c.idle_time&&(n("visitor idle"),c.is_idle||(c.is_idle=1,g("cev",{ev:"change_activity",status:"idle"})),clearInterval(c.idle_interval),delete c.idle_interval)};c.idle_interval=setInterval(db,6E4);var w=function(){c.idle_time=0;c.is_idle&&
(n("visitor active"),c.is_idle=0,g("cev",{ev:"change_activity",status:"active"}),c.idle_interval||(c.idle_interval=setInterval(db,6E4)))};k(z).mousemove(function(a){w()});k(z).keypress(function(a){w()});e.find("html").mousemove(function(a){w()});e.find("html").keypress(function(a){w()})},pa=function(a){var c="";f.each(b.agents,function(b){b.username==a&&(c=b)});return c},Da=function(a){var c=b.lang.other.visitor_end_chat;"undefined"!=typeof a&&a.message&&(c=a.message);na(c);ja("disable");Ha("hide");
Ia("hide");a=b.session;a.last_agent=a.agent;delete a.agent},Ea=function(a,b,c){r._gaq=r._gaq||[];"undefined"!=typeof c?r._gaq.push(["_trackEvent",a,b,c]):r._gaq.push(["_trackEvent",a,b])},$a=function(){var a=P();a++;Ra(a)},ab=function(){var a=c.new_message_on_page||0,b=P();0<b?pb("("+b+") "+ea):"blur"==B&&(a++,c.new_message_on_page=a,pb("("+a+") "+ea))},bb=function(){var a=b.session.sound||"on";"blur"==B&&"on"==a&&e.find("#audio_alert")[0].play()},Ka={core_version:"2.20140503",is_local:!1,is_debug:!1,
init:function(){if("1"==p.get("__sbzbl"))return!1;p.get("__sbzer")&&(Ka.is_debug=!0);c.p="https:"==r.location.protocol?"https:":"http:";c.url_static=O("http://static.subiz.com/");c.url_socket="https://sock-ha.subiz.com";c.url_sock_p=O("http://sock-p.subiz.com/");c.url_dashboard=O("http://static-dashboard.subiz.com/");c.url_css=O(c.url_dashboard+"widget/css/"+c.aid+"/subiz-widget-view.css");c.url_avatar=O(c.url_dashboard+"img/avatar-chat.png");var a=p.get("__sbzid")||"",d=p.get("__sbzsid")||"",e=[];
e.push("aid="+c.aid);e.push("vid="+a);e.push("sid="+d);c.url_base_data=c.url_sock_p+"a/"+c.aid+"?vid="+a;c.url_socket+="/?"+e.join("&");n("begin load static files");Xa(c.url_static+"views/widget.txt",function(a){n("cb get template");try{b.html=K.parse(a),b.html_ready=!0}catch(c){n("Error parse json data"),n(c),b.html={},b.html_ready=!1}});Xa(c.url_css,function(a){n("css ready");b.css=a.replace(/..\/..\/img\//g,c.url_dashboard+"widget/img/");b.css_ready=!0});Xa(c.url_base_data,function(a){n("cb get base data");
try{a=K.parse(a);if(a.is_deny){n("deny request");p.set("__sbzbl","1",{path:"/"});q.base_ready&&q.base_ready.id&&clearTimeout(q.base_ready.id);return}if(!a.status){n("error : base data");return}}catch(d){n("error : decode base data");n(d);return}n("build base widget");b.lang=a.widget.language.data;b.lang.online.title_compress||(b.lang.online.title_compress=b.lang.online.title,b.lang.offline.title_compress=b.lang.offline.title);var e=a.widget.survey,f=a.widget.offline_survey||{};e.name&&e.name.status||
(f.name={status:"active",is_require:1},f.email={status:"active",is_require:1},f.phone={status:f.phone||e.phone,is_require:1},f.department={status:e.department,is_require:1},e.name={status:"active",is_require:1},e.email={status:"active",is_require:1},e.phone={status:e.phone,is_require:1},e.question={status:e.question,is_require:1},e.department={status:e.department,is_require:1},a.widget.offline_survey=f);b.widget=a.widget;c.status_widget=a.status;c.status_account=a.status;c._status_account=a._status;
c.position=a.position||"right";Na(function(){k("body").waitUntilExists(tb)})});L.js({io:c.url_static+"public/js/io/socket.io.min.js"},{j:c.url_static+"public/js/j.min.js"},{_:c.url_static+"public/js/underscore-1.5.1.min.js"},function(){n("all js loaded");b.js_ready=!0});L.ready("io",function(){Oa("io",sb)});L.ready("j",function(){n("jquery ready");k=jQuery.noConflict(!0)});L.ready("_",function(){n("_ ready");f=r._.noConflict()})},test:function(){Ka.init()}},vb={_setAccount:function(a){c.aid=a;Ka.init()},
expandWidget:function(){var a="api_expand_widget:"+(new Date).getTime();Oa(a,function(){c.is_expand||("online"==c.status_widget?e.find(".button_chat_online").click():l.find(".button_chat_offline").click())})},setInfo:function(a){"undefined"==typeof a||1>a.length||(n("api set_info - waiting all ready"),Pa("api_set_info",function(){n("api set_info - all ready");var b=f.pick(a,["name","email","phone"]),d;for(d in b)f.isEmpty(b[d])&&delete b[d];if(!f.isEmpty(b))if(f.each(b,function(a,b){"email"==b?ua(a)&&
u(b,a):u(b,a)}),"offline"==c._status_account){d=p.get("__sbzid")||"";var e=p.get("__sbzsid")||"",h=["aid="+c.aid,"vid="+d,"sid="+e];f.each(b,function(a,b){h.push(b+"="+encodeURIComponent(a))});Fa(c.url_sock_p+"ev/set_info",h.join("&"),function(a){})}else g("cev",f.extend(b,{ev:"set_info"}))}))}},O=function(a){if(!a)return"";var b="https:"==z.location.protocol?"https://":"http://";a=a.replace(/^https?\:\/\//gi,"");return b+a},qb=function(a,b,c,d){if(r.XDomainRequest){var e=new XDomainRequest;e.onload=
function(){d(e.responseText)};e.onprogress=function(){};e.ontimeout=function(){};e.onerror=function(){};"POST"==b?(e.open("POST",a),e.send(c)):(e.open("GET",a),e.send())}else{if(-1!=navigator.userAgent.indexOf("MSIE")&&8>parseInt(navigator.userAgent.match(/MSIE ([\d.]+)/)[1],10))return console.log("IE < 8"),!1;var f=E();f.onreadystatechange=function(){4==f.readyState&&200==f.status&&d(f.responseText)};"POST"==b?(f.open("POST",a,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),
f.send(c)):(f.open("GET",a,!0),f.send())}},Xa=function(a,b){qb(a,"GET",null,b)},Fa=function(a,b,c){qb(a,"POST",b,c)},D=function(a){var b=new Date("2012-01-01T00:00:00Z"),b=b.getTime()+6E4*b.getTimezoneOffset(),b=Math.floor(b/1E3),c=new Date,c=c.getTime()+6E4*c.getTimezoneOffset(),b=Math.floor(c/1E3)-b+1325376E3;void 0==a||isNaN(a)||(b+=3600*a);return b},n=function(a){Ka.is_debug&&console.log(a)},ka=function(){v.new_message&&(clearInterval(v.new_message),r.document.title=ea,k(r).off("mousemove",ka),
k(r).off("focus",ka),v.new_message=null,c.new_message_on_page=0,n("clear blink"))},pb=function(a){var b=function(){r.document.title=r.document.title==ea?a:ea};v.new_message&&(clearInterval(v.new_message),r.document.title=ea,k(r).off("mousemove",ka),k(r).off("focus",ka),v.new_message=null,n("clear old blink"));v.new_message||(v.new_message=setInterval(b,500),k(r).on("mousemove",ka),k(r).on("focus",ka),e.find("html").on("mousemove",ka),e.find("html").on("focus",ka),n("set blink"))},ua=function(a){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a||
"")},e=null,l=null,Y=function(a){"show"==a?(k(".sbzon").show(),c.status_widget="online"):k(".sbzon").hide()},X=function(a){"show"==a?(k(".sbzoff").show(),c.status_widget="offline"):k(".sbzoff").hide()},F=function(a,b){if("online"==a){k(".sbzon").css({width:"100%",height:"100%"});var c=e.find("#subiz_wrapper").width(),d=e.find("#subiz_wrapper").height();k(".sbzon").css({width:c,height:d});"undefined"!=typeof b&&("undefined"!=typeof b.height&&b.height&&k(".sbzon").css("height",b.height),"undefined"!=
typeof b.width&&b.width&&k(".sbzon").css("width",b.width))}else k(".sbzoff").css({width:"100%",height:"100%"}),c=l.find("#subiz_wrapper").width(),d=l.find("#subiz_wrapper").height(),k(".sbzoff").css({width:c,height:d}),"undefined"!=typeof b&&("undefined"!=typeof b.height&&b.height&&k(".sbzoff").css("height",b.height),"undefined"!=typeof b.width&&b.width&&k(".sbzoff").css("width",b.width))},fa=function(a){"show"==a?(e.find(".button_chat_online").show(),F("online"),c.widget_window="online_compress"):
e.find(".button_chat_online").hide()},ga=function(a){"show"==a?(e.find(".widget_body").show(),F("online")):e.find(".widget_body").hide()},ha=function(a){"show"==a?(l.find(".button_chat_offline").show(),F("offline"),c.widget_window="offline_compress"):l.find(".button_chat_offline").hide()},ia=function(a){"show"==a?(l.find(".widget_body").show(),F("offline")):l.find(".widget_body").hide()},aa=function(a){"show"==a?(e.find("#subiz_chat").show(),F("online"),Ya(),c.widget_window="chat"):e.find("#subiz_chat").hide()},
W=function(a){"toogle"==a?e.find(".option_form").is(":hidden")?W("show"):W("hide"):"show"==a?(wa("hide"),xa("hide"),Wa("hide"),Aa("show"),e.find(".option_form").show()):(e.find(".option_form").hide(),wa("hide"),xa("hide"),Wa("hide"),Aa("show"))},Aa=function(a){"show"==a?e.find("#option_default").show():e.find("#option_default").hide()},Ta=function(a){"show"==a?e.find("#email_transcript").parent().show():e.find("#email_transcript").parent().hide()},Ha=function(a){"show"==a?e.find("#btn_endchat").parent().show():
e.find("#btn_endchat").parent().hide()},Sa=function(a){"on"==a?(e.find(".option_config_sound i").removeClass("icon_sound_off"),e.find(".option_config_sound i").addClass("icon_sound")):(e.find(".option_config_sound i").removeClass("icon_sound"),e.find(".option_config_sound i").addClass("icon_sound_off"))},za=function(a){"show"==a?e.find(".endchat_form").css("display","inline"):e.find(".endchat_form").hide()},wa=function(a){"show"==a?e.find("#option_contact_details").show():e.find("#option_contact_details").hide()},
xa=function(a){"show"==a?e.find("#option_edit_successful").show():e.find("#option_edit_successful").hide()},Wa=function(a){"show"==a?e.find("#option_email_transcript").show():e.find("#option_email_transcript").hide()},Ra=function(a){a&&0<a?e.find(".notice_new_message").html(a).show():e.find(".notice_new_message").html(0).hide()},Ua=function(a){"show"==a?e.find("#bl_rating").show():e.find("#bl_rating").hide()},$=function(a){"show"==a?(e.find("#survey").show(),F("online"),c.widget_window="survey"):
e.find("#survey").hide()},gb=function(a){"show"==a?e.find("#v_name_survey").closest("div").show():e.find("#v_name_survey").closest("div").hide()},hb=function(a){"show"==a?e.find("#v_email_survey").closest("div").show():e.find("#v_email_survey").closest("div").hide()},ib=function(a){"show"==a?e.find("#v_phone_survey").closest("div").show():e.find("#v_phone_survey").closest("div").hide()},jb=function(a){"show"==a?e.find("#v_question_survey").closest("div").show():e.find("#v_question_survey").closest("div").hide()},
kb=function(a){"show"==a?e.find("#department").show():e.find("#department").hide()},lb=function(a){"show"==a?l.find("#v_name_offline").closest("div").show():l.find("#v_name_offline").closest("div").hide()},mb=function(a){"show"==a?l.find("#v_email_offline").closest("div").show():l.find("#v_email_offline").closest("div").hide()},nb=function(a){"show"==a?l.find("#v_phone_offline").closest("div").show():l.find("#v_phone_offline").closest("div").hide()},ob=function(a){"show"==a?(l.find("#department_edit").show(),
l.find("#department").show()):(l.find("#department_edit").hide(),l.find("#department").hide())},qa=function(a){"show"==a?(l.find("#offline_active_box").show(),F("offline"),c.widget_window="message_offline"):l.find("#offline_active_box").hide()},va=function(a){"show"==a?(l.find("#subiz_offline").show(),F("offline"),c.widget_window="message_offline"):l.find("#subiz_offline").hide()},Ga=function(a){var d=b.visitor;"show"==a?(a=!0,d.name&&(a=!1,u("name",d.name)),d.email&&(a=!1,u("email",d.email)),a?(qa("hide"),
va("show")):(va("hide"),qa("show")),c.widget_window="message_offline"):(va("hide"),qa("hide"))},ra=function(a){"show"==a?(l.find("#message_successful").show(),F("offline"),c.widget_window="thank_you"):l.find("#message_successful").hide()},ma=function(a,d){d=C.link(d,{stripPrefix:!1});(a=a||"")&&!a.name&&(a={name:"Agent",avatar:c.url_avatar});var g=""==a?"visitor_chat":"supporter_chat",h=e.find(".subiz_conversionin > div.visitor_chat, div.supporter_chat").last(),k="",k=h.find("label.name").html();
"undefined"!=typeof a.name&&h&&h.attr("class")==g&&a.name!=k&&(h=null);(k=e.find(".subiz_conversionin > div").last())&&"text_notice_inline"==k.attr("class")&&(h=null);h&&h.attr("class")==g?(k=""==a?'<div class="line_message"><span class="visitor_content_chat">'+d+"</span></div>":'<div class="line_message"><img src="'+O(a.avatar)+'" alt="" class="avatar_small"><span class="supporter_content_chat">'+d+"</span></div>",h.append(k)):(k=""==a?'<div class="visitor_chat"><label class="name"><a href="javascript:;" class="visitor_name">'+
f.escape(b.visitor.name||"Me")+'</a></label><div class="line_message"><span class="visitor_content_chat">'+d+"</span></div></div>":'<div class="supporter_chat"><label class="name">'+f.escape(a.name)+'</label><div class="line_message"><img src="'+O(a.avatar)+'" alt="" class="avatar_small"><span class="supporter_content_chat">'+d+"</span></div></div>",e.find(".subiz_conversionin").append(k));Ya()},ja=function(a){"enable"==a?(e.find("input[type=text], textarea, select").removeAttr("disabled"),l.find("input[type=text], textarea, select").removeAttr("disabled")):
(e.find("input[type=text], textarea, select").attr("disabled",!0),l.find("input[type=text], textarea, select").attr("disabled",!0))},ya=function(a){"show"==a?e.find(".message_welcome").show():e.find(".message_welcome").hide()},eb=function(a){n("loading : "+a);"show"==a?e.find("#subiz_loading").show():e.find("#subiz_loading").hide()},fb=function(a){"show"==a?l.find("#subiz_loading").show():l.find("#subiz_loading").hide()},Ia=function(a){"show"==a?e.find(".widget_body_footer .btnendchat").show():e.find(".widget_body_footer .btnendchat").hide()},
Ja=function(a,c){"show"==a?f.each(b.agents,function(a){a.username==c&&(n("UI typing : found agent"),a=b.lang.online.typing.replace("{agent}",f.escape(a.name)),e.find(".text_notice").html(a).show())}):e.find(".text_notice").hide()},na=function(a){a=f.template('<div class="text_notice_inline"><%= message %></div>',{message:a});e.find(".subiz_conversionin").append(a);Ya()},Va=function(a,b){var d=f.template('<div class="chat_warning notification_widget '+("undefined"==typeof b?"":"notification_"+b)+'"><label class="name_chat_warning"><%= message %></label><a href="javascript:;" class="close_notification_widget"><i class="widget-sprites icon_actions icon_delete"></i></a></div>',
{message:a});"online"==c.status_widget?(e.find(".chat_warning").remove(),e.find(".widget_body_inner").append(d)):(l.find(".chat_warning").remove(),l.find(".widget_body_inner").append(d))},ba=function(a){"show"==a?e.find("#subiz-bubble").show():e.find("#subiz-bubble").hide()},Ya=function(){var a=e.find(".subiz_conversionin")[0];"undefined"!=typeof a&&a.scrollHeight&&(a.scrollTop=a.scrollHeight)},rb=function(a){var b=a[0];a=a.slice(1);vb[b].apply(this,a)};if(0<d.length)for(d.reverse();d.length;){var wb=
d.pop();rb(wb)}r._sbzq={push:rb}})(_sbzq);
